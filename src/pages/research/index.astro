---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { researchNotes, getNotesByMonth } from '../../data/research-notes';
import { FileText, BookOpen, Rocket, MessageSquare, ArrowRight } from '@lucide/astro';

const notesByMonth = getNotesByMonth();
const months = Array.from(notesByMonth.keys()).sort().reverse();

const sourceTypeIcons = {
  paper: FileText,
  blog: BookOpen,
  release: Rocket,
  discussion: MessageSquare,
};

const sourceTypeColors = {
  paper: 'bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300',
  blog: 'bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300',
  release: 'bg-purple-100 text-purple-800 dark:bg-purple-900/50 dark:text-purple-300',
  discussion: 'bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-300',
};

function formatMonth(monthStr: string): string {
  const [year, month] = monthStr.split('-');
  const date = new Date(parseInt(year), parseInt(month) - 1);
  return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
}
---

<BaseLayout title="Research Notes" description="High-signal research log tracking developments in decentralized machine learning">
  <section class="py-12 lg:py-20">
    <div class="container-wide">
      <div class="max-w-3xl mb-12">
        <h1 class="text-4xl font-bold mb-4">Research Notes</h1>
        <p class="text-lg text-slate-600 dark:text-slate-400 mb-4">
          Tracking developments that may change how decentralized machine learning systems are built and understood.
        </p>
        <p class="text-slate-600 dark:text-slate-400">
          A high-signal, system-level research log covering papers, releases, and discussions.
        </p>
      </div>

      <div class="flex flex-wrap gap-4 mb-8">
        <div class="flex items-center gap-2 text-sm">
          <span class={`tag ${sourceTypeColors.paper}`}>
            <FileText class="w-3 h-3 mr-1" />
            Paper
          </span>
        </div>
        <div class="flex items-center gap-2 text-sm">
          <span class={`tag ${sourceTypeColors.blog}`}>
            <BookOpen class="w-3 h-3 mr-1" />
            Blog
          </span>
        </div>
        <div class="flex items-center gap-2 text-sm">
          <span class={`tag ${sourceTypeColors.release}`}>
            <Rocket class="w-3 h-3 mr-1" />
            Release
          </span>
        </div>
        <div class="flex items-center gap-2 text-sm">
          <span class={`tag ${sourceTypeColors.discussion}`}>
            <MessageSquare class="w-3 h-3 mr-1" />
            Discussion
          </span>
        </div>
      </div>

      <div class="space-y-12">
        {months.map((month) => {
          const notes = notesByMonth.get(month) || [];
          return (
            <section>
              <h2 class="text-2xl font-bold mb-6 sticky top-20 bg-slate-50 dark:bg-slate-950 py-2 z-10">
                {formatMonth(month)}
              </h2>
              <div class="space-y-4">
                {notes.map((note) => {
                  const Icon = sourceTypeIcons[note.sourceType];
                  return (
                    <a href={`/research/${note.slug}`} class="card p-6 block group">
                      <div class="flex flex-col sm:flex-row sm:items-start gap-4">
                        <div class="flex items-center gap-4 shrink-0">
                          <time class="text-sm text-slate-500 font-mono w-24">{note.date}</time>
                          <span class={`tag ${sourceTypeColors[note.sourceType]}`}>
                            <Icon class="w-3 h-3 mr-1" />
                            {note.sourceType}
                          </span>
                        </div>
                        <div class="flex-1 min-w-0">
                          <h3 class="font-semibold text-lg group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors mb-2">
                            {note.title}
                          </h3>
                          <p class="text-slate-600 dark:text-slate-400 text-sm mb-3 line-clamp-2">
                            {note.summary}
                          </p>
                          <div class="flex flex-wrap gap-2">
                            {note.tags.map((tag) => (
                              <span class="tag-primary text-xs">{tag}</span>
                            ))}
                            {note.relatedProjects?.map((project) => (
                              <span class="tag-accent text-xs">{project}</span>
                            ))}
                          </div>
                        </div>
                        <ArrowRight class="w-5 h-5 text-slate-400 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors shrink-0 hidden sm:block" />
                      </div>
                    </a>
                  );
                })}
              </div>
            </section>
          );
        })}
      </div>
    </div>
  </section>
</BaseLayout>
